#!/usr/bin/env zunit

@setup {
    load ../fzf-zsh-completions.plugin.zsh
    TEMP=$(mktemp -d)
    pushd $TEMP
}

@test 'Testing completion: make **' {
MAKEFILE_CONTENT=$(cat <<< "
aoi:
echo 'Yeah, Akane-chang is very cute'
akane:
echo 'Yeah, Aoi-chang is very cute'
"
)

echo $MAKEFILE_CONTENT > Makefile
_fzf_complete() {
    assert $# equals 2

    assert $2 same_as 'make '
    run cat
    assert ${lines[1]} same_as 'akane'
    assert ${lines[2]} same_as 'aoi'
}

prefix=_fzf_complete_make 'make '
